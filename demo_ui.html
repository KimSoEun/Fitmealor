<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitmealor - AI ì‹ë‹¨ ì¶”ì²œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn:active {
            transform: translateY(0);
        }
        .meal-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }
        .meal-card h3 {
            color: #333;
            margin-bottom: 10px;
        }
        .meal-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .stat {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 10px;
        }
        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .safe-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        .safe {
            background: #d4edda;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
        }
        #results {
            display: none;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .allergen-checkboxes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .checkbox-item:hover {
            background: #e9ecef;
        }
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            cursor: pointer;
        }
        .checkbox-item label {
            margin: 0;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            flex: 1;
        }
        .filter-info {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        .filter-info strong {
            color: #856404;
        }
        .nav-bar {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-bar a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 10px;
            transition: background 0.3s;
            font-weight: 600;
        }
        .nav-bar a:hover {
            background: rgba(255,255,255,0.2);
        }
        .nav-links {
            display: flex;
            gap: 10px;
        }
        .chat-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .chat-message {
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .chat-message.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }
        .chat-message.assistant {
            background: white;
            color: #333;
            align-self: flex-start;
            border: 1px solid #e0e0e0;
        }
        .chat-input-group {
            display: flex;
            gap: 10px;
        }
        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }
        .chat-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .chat-send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .chat-send-btn:hover {
            transform: translateY(-2px);
        }
        .chat-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .recommendation-reason {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .recommendation-reason h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .recommendation-reason p {
            color: #333;
            line-height: 1.6;
            margin: 0;
        }
        .user-info {
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-name {
            font-weight: 600;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 0;
            }
            .header h1 {
                font-size: 2em;
            }
            .header p {
                font-size: 0.9em;
            }
            .card {
                padding: 20px;
                border-radius: 15px;
            }
            .grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .meal-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            .allergen-checkboxes {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            .checkbox-item {
                padding: 8px;
            }
            .checkbox-item label {
                font-size: 12px;
            }
            .nav-bar {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            .nav-links {
                flex-direction: column;
                width: 100%;
            }
            .nav-links a {
                text-align: center;
                width: 100%;
            }
            .user-info {
                flex-direction: column;
                gap: 5px;
                width: 100%;
            }
            .user-info a {
                width: 100%;
                text-align: center;
            }
            .meal-card {
                padding: 15px;
            }
            .meal-card h3 {
                font-size: 1.1em;
            }
            .stat-value {
                font-size: 18px;
            }
            .stat-label {
                font-size: 11px;
            }
            input, select {
                font-size: 16px;
                padding: 14px;
            }
            .btn {
                padding: 16px 30px;
                font-size: 16px;
            }
            .form-group {
                margin-bottom: 15px;
            }
            label {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }
            .card {
                padding: 15px;
            }
            .allergen-checkboxes {
                grid-template-columns: 1fr;
            }
            .meal-stats {
                grid-template-columns: 1fr;
            }
            .checkbox-item label {
                font-size: 13px;
            }
        }

        /* Typing indicator animation */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 10px 15px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #667eea;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        /* Language toggle switch */
        .language-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .language-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 28px;
        }

        .language-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .language-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: 0.4s;
            border-radius: 28px;
        }

        .language-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .language-switch input:checked + .language-slider:before {
            transform: translateX(32px);
        }

        .language-label {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-bar" id="navBar" style="display: none;">
            <div class="nav-links">
                <a href="demo_ui.html">ğŸ  Home / í™ˆ</a>
                <a href="profile.html">ğŸ‘¤ Profile / í”„ë¡œí•„</a>
            </div>
            <div class="user-info">
                <span class="user-name" id="navUserName">User</span>
                <a href="#" id="navLogoutBtn">ğŸšª Logout / ë¡œê·¸ì•„ì›ƒ</a>
                <!-- Language Toggle -->
                <div class="language-toggle" style="position: relative; margin-left: 20px;">
                    <span class="language-label">KO</span>
                    <label class="language-switch">
                        <input type="checkbox" id="languageToggle">
                        <span class="language-slider"></span>
                    </label>
                    <span class="language-label">EN</span>
                </div>
            </div>
        </div>

        <div class="header">
            <h1>ğŸ¥— Fitmealor</h1>
            <p>AI-Powered Meal Recommendations for Foreigners in Korea</p>
            <p style="font-size: 0.9em; margin-top: 10px;">ì™¸êµ­ì¸ì„ ìœ„í•œ AI ê¸°ë°˜ ì‹ë‹¨ ì¶”ì²œ ì„œë¹„ìŠ¤</p>
        </div>

        <div class="card" id="welcomeCard" style="display: none;">
            <h2 style="color: #667eea; margin-bottom: 15px;">ğŸ‘‹ Welcome! / í™˜ì˜í•©ë‹ˆë‹¤!</h2>
            <p style="font-size: 1.1em; color: #333; margin-bottom: 20px;">
                <strong id="welcomeUserName">User</strong>ë‹˜ì˜ ê±´ê°• í”„ë¡œí•„ì„ ê¸°ë°˜ìœ¼ë¡œ ë§ì¶¤ ì‹ë‹¨ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.
            </p>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                <div class="grid">
                    <div>
                        <p style="color: #666; margin-bottom: 5px;">ğŸ¯ Goal / ê±´ê°• ëª©í‘œ</p>
                        <p style="font-weight: 600; color: #667eea;" id="welcomeGoal">-</p>
                    </div>
                    <div>
                        <p style="color: #666; margin-bottom: 5px;">ğŸ“Š TDEE / ì¼ì¼ ê¶Œì¥ ì¹¼ë¡œë¦¬</p>
                        <p style="font-weight: 600; color: #667eea;" id="welcomeTDEE">-</p>
                    </div>
                    <div>
                        <p style="color: #666; margin-bottom: 5px;">âš–ï¸ Current Weight / í˜„ì¬ ì²´ì¤‘</p>
                        <p style="font-weight: 600; color: #667eea;" id="welcomeWeight">-</p>
                    </div>
                    <div>
                        <p style="color: #666; margin-bottom: 5px;">ğŸ¯ Target Weight / ëª©í‘œ ì²´ì¤‘</p>
                        <p style="font-weight: 600; color: #667eea;" id="welcomeTargetWeight">-</p>
                    </div>
                </div>
            </div>
            <p style="color: #666; text-align: center; margin-top: 15px;">
                ì˜¤ëŠ˜ì˜ ëª¸ ìƒíƒœë¥¼ ì•„ë˜ì— ì…ë ¥í•´ì£¼ì„¸ìš” â¬‡ï¸<br>
                Tell us about your body condition today
            </p>
        </div>

        <!-- Chat Interface -->
        <div class="card" id="chatCard" style="display: none;">
            <h2 style="margin-bottom: 15px;">ğŸ’¬ Chat with AI Nutritionist / AI ì˜ì–‘ì‚¬ì™€ ëŒ€í™”í•˜ê¸°</h2>
            <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">
                ì˜¤ëŠ˜ ëª¸ ìƒíƒœê°€ ì–´ë– ì‹ ê°€ìš”? í”¼ê³¤í•¨, ì†Œí™”ë¶ˆëŸ‰, ê·¼ìœ¡í†µ ë“±ì„ ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”.<br>
                How are you feeling today? Tell us about fatigue, digestion, muscle pain, etc.
            </p>

            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message assistant">
                        ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” Fitmealorì˜ AI ì˜ì–‘ì‚¬ì…ë‹ˆë‹¤.<br>
                        ì˜¤ëŠ˜ ëª¸ ìƒíƒœê°€ ì–´ë– ì‹ ê°€ìš”? ë¨¹ê³  ì‹¶ì€ ìŒì‹ë„ ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”!<br><br>
                        Hello! I'm Fitmealor's AI nutritionist.<br>
                        How are you feeling today? Feel free to tell me what you'd like to eat!
                    </div>
                </div>

                <div class="chat-input-group">
                    <input type="text"
                           class="chat-input"
                           id="chatInput"
                           placeholder="ì˜ˆ: ì˜¤ëŠ˜ í”¼ê³¤í•´ìš”. ë§¤ìš´ ìŒì‹ ë¨¹ê³  ì‹¶ì–´ìš” / e.g., I'm tired today. I want something spicy"
                           maxlength="300">
                    <button class="chat-send-btn" id="chatSendBtn">
                        ğŸ’¬ Send / ì „ì†¡
                    </button>
                </div>
            </div>
        </div>

        <div class="card" id="allergenFilterCard" style="display: none;">
            <h2 style="margin-bottom: 20px;">ğŸš« Allergen Filters / ì•ŒëŸ¬ì§€ í•„í„°</h2>
            <p style="color: #666; margin-bottom: 15px;">
                ì•ŒëŸ¬ì§€ê°€ ìˆëŠ” í•­ëª©ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì„±ë¶„ì´ í¬í•¨ëœ ì‹ë‹¨ì€ ì œì™¸ë©ë‹ˆë‹¤.<br>
                Select allergens to exclude meals containing those ingredients.
            </p>
            <div class="allergen-checkboxes">
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-eggs" value="eggs" class="allergen-filter-checkbox">
                    <label for="filter-eggs">Eggs / ë‚œë¥˜</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-milk" value="milk" class="allergen-filter-checkbox">
                    <label for="filter-milk">Milk / ìš°ìœ </label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-buckwheat" value="buckwheat" class="allergen-filter-checkbox">
                    <label for="filter-buckwheat">Buckwheat / ë©”ë°€</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-peanuts" value="peanuts" class="allergen-filter-checkbox">
                    <label for="filter-peanuts">Peanuts / ë•…ì½©</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-soybeans" value="soybeans" class="allergen-filter-checkbox">
                    <label for="filter-soybeans">Soybeans / ëŒ€ë‘</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-wheat" value="wheat" class="allergen-filter-checkbox">
                    <label for="filter-wheat">Wheat / ë°€</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-mackerel" value="mackerel" class="allergen-filter-checkbox">
                    <label for="filter-mackerel">Mackerel / ê³ ë“±ì–´</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-crab" value="crab" class="allergen-filter-checkbox">
                    <label for="filter-crab">Crab / ê²Œ</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-shrimp" value="shrimp" class="allergen-filter-checkbox">
                    <label for="filter-shrimp">Shrimp / ìƒˆìš°</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-pork" value="pork" class="allergen-filter-checkbox">
                    <label for="filter-pork">Pork / ë¼ì§€ê³ ê¸°</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-peach" value="peach" class="allergen-filter-checkbox">
                    <label for="filter-peach">Peach / ë³µìˆ­ì•„</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-tomato" value="tomato" class="allergen-filter-checkbox">
                    <label for="filter-tomato">Tomato / í† ë§ˆí† </label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-sulfites" value="sulfites" class="allergen-filter-checkbox">
                    <label for="filter-sulfites">Sulfites / ì•„í™©ì‚°ë¥˜</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-walnuts" value="walnuts" class="allergen-filter-checkbox">
                    <label for="filter-walnuts">Walnuts / í˜¸ë‘</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-chicken" value="chicken" class="allergen-filter-checkbox">
                    <label for="filter-chicken">Chicken / ë‹­ê³ ê¸°</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-beef" value="beef" class="allergen-filter-checkbox">
                    <label for="filter-beef">Beef / ì‡ ê³ ê¸°</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-squid" value="squid" class="allergen-filter-checkbox">
                    <label for="filter-squid">Squid / ì˜¤ì§•ì–´</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-shellfish" value="shellfish" class="allergen-filter-checkbox">
                    <label for="filter-shellfish">Shellfish / ì¡°ê°œë¥˜</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-pine-nuts" value="pine_nuts" class="allergen-filter-checkbox">
                    <label for="filter-pine-nuts">Pine Nuts / ì£</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-mussels" value="mussels" class="allergen-filter-checkbox">
                    <label for="filter-mussels">Mussels / í™í•©</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-abalone" value="abalone" class="allergen-filter-checkbox">
                    <label for="filter-abalone">Abalone / ì „ë³µ</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-oysters" value="oysters" class="allergen-filter-checkbox">
                    <label for="filter-oysters">Oysters / êµ´</label>
                </div>
            </div>
        </div>

        <div class="card" id="healthFormCard">
            <h2 style="margin-bottom: 20px;">Enter Your Health Information / ê±´ê°• ì •ë³´ ì…ë ¥</h2>
            <p style="color: #666; margin-bottom: 20px;">
                ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì„ì‹œ ì…ë ¥ í¼ì…ë‹ˆë‹¤. íšŒì›ê°€ì…í•˜ì‹œë©´ ì •ë³´ê°€ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
            </p>
            <form id="healthForm">
                <div class="grid">
                    <div class="form-group">
                        <label>Age / ë‚˜ì´</label>
                        <input type="number" id="age" value="28" required>
                    </div>
                    <div class="form-group">
                        <label>Gender / ì„±ë³„</label>
                        <select id="gender">
                            <option value="unspecified">Prefer not to say / ì„ íƒ ì•ˆ í•¨</option>
                            <option value="male">Male / ë‚¨ì„±</option>
                            <option value="female">Female / ì—¬ì„±</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Height / í‚¤ (cm)</label>
                        <input type="number" id="height" value="175" required>
                    </div>
                    <div class="form-group">
                        <label>Weight / ì²´ì¤‘ (kg)</label>
                        <input type="number" id="weight" value="70" required>
                    </div>
                    <div class="form-group">
                        <label>Target Weight / ëª©í‘œ ì²´ì¤‘ (kg)</label>
                        <input type="number" id="targetWeight" value="65" required>
                    </div>
                    <div class="form-group">
                        <label>Activity Level / í™œë™ëŸ‰</label>
                        <select id="activity">
                            <option value="sedentary">Sedentary / ë¹„í™œë™ì </option>
                            <option value="light">Light / ê°€ë²¼ìš´ í™œë™</option>
                            <option value="moderate" selected>Moderate / ë³´í†µ</option>
                            <option value="active">Active / í™œë™ì </option>
                            <option value="very_active">Very Active / ë§¤ìš° í™œë™ì </option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Health Goal / ê±´ê°• ëª©í‘œ</label>
                    <select id="goal">
                        <option value="lose_weight">Lose Weight / ì²´ì¤‘ ê°ëŸ‰</option>
                        <option value="maintain">Maintain / ìœ ì§€</option>
                        <option value="gain_muscle">Gain Muscle / ê·¼ìœ¡ ì¦ê°€</option>
                        <option value="bulk_up">Bulk Up / ë²Œí¬ì—…</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Allergy Filters / ì•Œë ˆë¥´ê¸° í•„í„°</label>
                    <div class="allergen-checkboxes">
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-eggs" value="eggs" class="allergen-checkbox">
                            <label for="allergy-eggs">Eggs / ë‚œë¥˜</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-milk" value="milk" class="allergen-checkbox">
                            <label for="allergy-milk">Milk / ìš°ìœ </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-buckwheat" value="buckwheat" class="allergen-checkbox">
                            <label for="allergy-buckwheat">Buckwheat / ë©”ë°€</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-peanuts" value="peanuts" class="allergen-checkbox">
                            <label for="allergy-peanuts">Peanuts / ë•…ì½©</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-soybeans" value="soybeans" class="allergen-checkbox">
                            <label for="allergy-soybeans">Soybeans / ëŒ€ë‘</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-wheat" value="wheat" class="allergen-checkbox">
                            <label for="allergy-wheat">Wheat / ë°€</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-mackerel" value="mackerel" class="allergen-checkbox">
                            <label for="allergy-mackerel">Mackerel / ê³ ë“±ì–´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-crab" value="crab" class="allergen-checkbox">
                            <label for="allergy-crab">Crab / ê²Œ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-shrimp" value="shrimp" class="allergen-checkbox">
                            <label for="allergy-shrimp">Shrimp / ìƒˆìš°</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-pork" value="pork" class="allergen-checkbox">
                            <label for="allergy-pork">Pork / ë¼ì§€ê³ ê¸°</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-peach" value="peach" class="allergen-checkbox">
                            <label for="allergy-peach">Peach / ë³µìˆ­ì•„</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-tomato" value="tomato" class="allergen-checkbox">
                            <label for="allergy-tomato">Tomato / í† ë§ˆí† </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-sulfites" value="sulfites" class="allergen-checkbox">
                            <label for="allergy-sulfites">Sulfites / ì•„í™©ì‚°ë¥˜</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-walnuts" value="walnuts" class="allergen-checkbox">
                            <label for="allergy-walnuts">Walnuts / í˜¸ë‘</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-chicken" value="chicken" class="allergen-checkbox">
                            <label for="allergy-chicken">Chicken / ë‹­ê³ ê¸°</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-beef" value="beef" class="allergen-checkbox">
                            <label for="allergy-beef">Beef / ì‡ ê³ ê¸°</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-squid" value="squid" class="allergen-checkbox">
                            <label for="allergy-squid">Squid / ì˜¤ì§•ì–´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-shellfish" value="shellfish" class="allergen-checkbox">
                            <label for="allergy-shellfish">Shellfish / ì¡°ê°œë¥˜</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-pine-nuts" value="pine_nuts" class="allergen-checkbox">
                            <label for="allergy-pine-nuts">Pine Nuts / ì£</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-mussels" value="mussels" class="allergen-checkbox">
                            <label for="allergy-mussels">Mussels / í™í•©</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-abalone" value="abalone" class="allergen-checkbox">
                            <label for="allergy-abalone">Abalone / ì „ë³µ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allergy-oysters" value="oysters" class="allergen-checkbox">
                            <label for="allergy-oysters">Oysters / êµ´</label>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn">ğŸ¤– Get AI Recommendations / AI ì‹ë‹¨ ì¶”ì²œ ë°›ê¸°</button>
            </form>
        </div>

        <div id="results" class="card">
            <h2 style="margin-bottom: 20px;">Recommended Meals / ì¶”ì²œ ì‹ë‹¨</h2>

            <!-- Recommendation Reason -->
            <div id="recommendationReason" class="recommendation-reason" style="display: none;">
                <h3>ğŸ’¡ Why these meals? / ì™œ ì´ ì‹ë‹¨ì¼ê¹Œìš”?</h3>
                <p id="reasonText"></p>
            </div>

            <div id="tdeeInfo" style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #1976d2;">ğŸ“Š Your Daily Calorie Target</h3>
                <p id="tdeeValue" style="font-size: 24px; font-weight: 700; color: #1976d2; margin-top: 10px;"></p>
            </div>
            <div id="filterInfo" class="filter-info" style="display: none;">
                <strong>ğŸ” Active Filters:</strong>
                <p id="filterList" style="margin-top: 5px;"></p>
                <p id="filterStats" style="margin-top: 10px; font-size: 14px;"></p>
            </div>
            <div id="mealsContainer"></div>
        </div>
    </div>

    <script>
        // Language management
        let currentLanguage = localStorage.getItem('fitmealor_language') || 'ko';
        let currentRecommendations = null; // Store recommendations for language switching

        // Store the current form data for re-fetching
        let currentFormData = null;
        let currentUser = null;
        let bodyCondition = ''; // Store body condition input
        let conversationHistory = []; // Store chat history for context
        let userPreferences = {}; // Store ChatGPT-extracted food preferences

        // Check authentication and load user profile
        async function checkAuth() {
            const token = localStorage.getItem('fitmealor_token');

            if (token) {
                try {
                    const response = await fetch('http://localhost:8000/api/v1/auth/profile', {
                        headers: {
                            'Authorization': 'Bearer ' + token
                        }
                    });

                    if (response.ok) {
                        currentUser = await response.json();
                        displayUserInfo();
                        loadUserProfile();
                    } else {
                        // Token invalid, clear storage
                        localStorage.removeItem('fitmealor_token');
                        localStorage.removeItem('fitmealor_user');
                        showGuestMode();
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                    showGuestMode();
                }
            } else {
                showGuestMode();
            }
        }

        function displayUserInfo() {
            const navBar = document.getElementById('navBar');
            const navUserName = document.getElementById('navUserName');

            if (currentUser) {
                navBar.style.display = 'flex';
                navUserName.textContent = currentUser.name + ' ë‹˜';
            }
        }

        function showGuestMode() {
            // Show link to login/register
            const header = document.querySelector('.header');
            const loginLink = document.createElement('p');
            loginLink.innerHTML = '<a href="login.html" style="color: white; text-decoration: underline;">ë¡œê·¸ì¸ / Login</a> ë˜ëŠ” <a href="register.html" style="color: white; text-decoration: underline;">íšŒì›ê°€ì… / Sign Up</a>';
            loginLink.style.marginTop = '15px';
            header.appendChild(loginLink);

            // Show health form for guest users
            document.getElementById('healthFormCard').style.display = 'block';
        }

        function loadUserProfile() {
            if (!currentUser) return;

            // Hide health form for logged-in users
            document.getElementById('healthFormCard').style.display = 'none';

            // Show welcome card, chat card, and allergen filter card
            document.getElementById('welcomeCard').style.display = 'block';
            document.getElementById('chatCard').style.display = 'block';
            document.getElementById('allergenFilterCard').style.display = 'block';

            // Display user info in welcome card
            const goalLabels = {
                'lose_weight': 'Lose Weight / ì²´ì¤‘ ê°ëŸ‰',
                'maintain': 'Maintain / ìœ ì§€',
                'gain_muscle': 'Gain Muscle / ê·¼ìœ¡ ì¦ê°€',
                'bulk_up': 'Bulk Up / ë²Œí¬ì—…'
            };

            document.getElementById('welcomeUserName').textContent = currentUser.name;
            document.getElementById('welcomeGoal').textContent = goalLabels[currentUser.health_goal] || currentUser.health_goal;
            document.getElementById('welcomeWeight').textContent = currentUser.weight_kg + ' kg';
            document.getElementById('welcomeTargetWeight').textContent = currentUser.target_weight_kg + ' kg';

            // Calculate TDEE
            let bmr;
            if (currentUser.gender === 'male') {
                bmr = 10 * currentUser.weight_kg + 6.25 * currentUser.height_cm - 5 * currentUser.age + 5;
            } else if (currentUser.gender === 'female') {
                bmr = 10 * currentUser.weight_kg + 6.25 * currentUser.height_cm - 5 * currentUser.age - 161;
            } else {
                bmr = 10 * currentUser.weight_kg + 6.25 * currentUser.height_cm - 5 * currentUser.age - 78;
            }
            const tdee = Math.round(bmr * 1.55);
            document.getElementById('welcomeTDEE').textContent = tdee + ' kcal/day';

            // Set allergen filters based on user profile
            document.querySelectorAll('.allergen-filter-checkbox').forEach(cb => {
                cb.checked = currentUser.allergies.includes(cb.value);
            });

            // Add event listeners to allergen filter checkboxes
            document.querySelectorAll('.allergen-filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    if (currentFormData) {
                        fetchRecommendations();
                    }
                });
            });

            // Auto-fill form data for recommendation
            currentFormData = {
                user_id: currentUser.email,
                age: currentUser.age,
                gender: currentUser.gender,
                height_cm: currentUser.height_cm,
                weight_kg: currentUser.weight_kg,
                target_weight_kg: currentUser.target_weight_kg,
                activity_level: currentUser.activity_level,
                health_goal: currentUser.health_goal
            };

            // Auto-load recommendations for logged-in users
            fetchRecommendations();
        }

        // Logout
        document.getElementById('navLogoutBtn')?.addEventListener('click', (e) => {
            e.preventDefault();
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? / Do you want to logout?')) {
                localStorage.removeItem('fitmealor_token');
                localStorage.removeItem('fitmealor_user');
                // Keep auto-login credentials for next login
                window.location.href = 'login.html';
            }
        });

        // Function to get selected allergies from checkboxes
        function getSelectedAllergies() {
            // For logged-in users, use filter checkboxes
            if (currentUser) {
                const checkboxes = document.querySelectorAll('.allergen-filter-checkbox:checked');
                return Array.from(checkboxes).map(cb => cb.value);
            }
            // For guest users, use form checkboxes
            const checkboxes = document.querySelectorAll('.allergen-checkbox:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', checkAuth);

        // Function to fetch recommendations
        async function fetchRecommendations() {
            if (!currentFormData) return;

            const allergies = getSelectedAllergies();
            const data = {
                ...currentFormData,
                allergies,
                body_condition: bodyCondition,  // Add body condition to request
                preferences: userPreferences  // Add ChatGPT-extracted food preferences
            };

            // Show loading
            document.getElementById('results').style.display = 'block';
            document.getElementById('mealsContainer').innerHTML = '<div class="loading">â³ AI is analyzing your personalized meal plan... / AIê°€ ë§ì¶¤ ì‹ë‹¨ì„ ë¶„ì„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

            try {
                const response = await fetch('http://localhost:8000/api/v1/recommendations/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                // Display recommendation reason if available
                if (result.recommendation_reason) {
                    document.getElementById('recommendationReason').style.display = 'block';
                    document.getElementById('reasonText').textContent = result.recommendation_reason;
                } else {
                    document.getElementById('recommendationReason').style.display = 'none';
                }

                // Display TDEE
                document.getElementById('tdeeValue').textContent = `${result.tdee} kcal/day`;

                // Update filter info
                const filterInfoDiv = document.getElementById('filterInfo');
                const filterListP = document.getElementById('filterList');
                const filterStatsP = document.getElementById('filterStats');

                if (allergies.length > 0) {
                    filterInfoDiv.style.display = 'block';
                    const allergenLabels = {
                        'peanuts': 'Peanuts / ë•…ì½©',
                        'tree nuts': 'Tree Nuts / ê²¬ê³¼ë¥˜',
                        'milk': 'Milk / ìš°ìœ ',
                        'eggs': 'Eggs / ê³„ë€',
                        'fish': 'Fish / ìƒì„ ',
                        'shellfish': 'Shellfish / ê°‘ê°ë¥˜',
                        'soy': 'Soy / ì½©',
                        'wheat': 'Wheat / ë°€',
                        'sesame': 'Sesame / ì°¸ê¹¨'
                    };
                    const selectedLabels = allergies.map(a => allergenLabels[a] || a);
                    filterListP.textContent = selectedLabels.join(', ');
                    filterStatsP.innerHTML = `ğŸ“Š <strong>${result.total_available}</strong> total meals | <strong>${result.filtered_out}</strong> filtered out | <strong>${result.total_recommendations}</strong> safe recommendations`;
                } else {
                    filterInfoDiv.style.display = 'none';
                }

                // Store recommendations for language switching
                currentRecommendations = result.recommendations;

                // Display meals
                const mealsHTML = result.recommendations.map(meal => `
                    <div class="meal-card">
                        <h3>${currentLanguage === 'en' ? (meal.name_en || meal.name) : meal.name}</h3>
                        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                            ${meal.brand ? `<span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600;">ğŸ¢ ${meal.brand}</span>` : ''}
                            ${meal.category ? `<span style="background: #e3f2fd; color: #1976d2; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600;">ğŸ“¦ ${meal.category}</span>` : ''}
                        </div>
                        <span class="safe-badge safe">
                            ${currentLanguage === 'en' ? 'âœ… Safe for your allergies' : 'âœ… ì•Œë ˆë¥´ê¸° ì•ˆì „'}
                        </span>
                        ${meal.serving_size ? `<p style="color: #555; font-size: 14px; margin-top: 8px; margin-bottom: 15px;"><strong>${currentLanguage === 'en' ? 'Serving Size:' : '1íšŒ ì œê³µëŸ‰:'}</strong> ${meal.serving_size}</p>` : ''}
                        ${meal.origin ? `<p style="color: #555; font-size: 14px; margin-bottom: 15px;"><strong>${currentLanguage === 'en' ? 'Origin:' : 'ì›ì‚°ì§€:'}</strong> ${meal.origin}</p>` : ''}
                        <div class="meal-stats">
                            <div class="stat">
                                <div class="stat-value">${meal.calories}</div>
                                <div class="stat-label">${currentLanguage === 'en' ? 'Calories' : 'ì¹¼ë¡œë¦¬'}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${meal.protein_g}g</div>
                                <div class="stat-label">${currentLanguage === 'en' ? 'Protein' : 'ë‹¨ë°±ì§ˆ'}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${meal.carbs_g}g</div>
                                <div class="stat-label">${currentLanguage === 'en' ? 'Carbs' : 'íƒ„ìˆ˜í™”ë¬¼'}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${meal.fat_g}g</div>
                                <div class="stat-label">${currentLanguage === 'en' ? 'Fat' : 'ì§€ë°©'}</div>
                            </div>
                            ${meal.sodium_mg ? `<div class="stat">
                                <div class="stat-value">${meal.sodium_mg}mg</div>
                                <div class="stat-label">${currentLanguage === 'en' ? 'Sodium' : 'ë‚˜íŠ¸ë¥¨'}</div>
                            </div>` : ''}
                        </div>
                        <p style="color: #666; line-height: 1.6;">
                            ${currentLanguage === 'en' ? meal.explanation_en : meal.explanation_ko}
                        </p>
                        <p style="margin-top: 10px; color: #667eea; font-weight: 600;">
                            ${currentLanguage === 'en' ? 'AI Score:' : 'AI ì ìˆ˜:'} ${meal.score}/100
                        </p>
                    </div>
                `).join('');

                document.getElementById('mealsContainer').innerHTML = mealsHTML ||
                    '<div style="text-align: center; padding: 40px; color: #666;">No safe meals found with current filters. Try removing some allergen filters.</div>';

            } catch (error) {
                document.getElementById('mealsContainer').innerHTML = `
                    <div style="color: #d32f2f; padding: 20px; text-align: center;">
                        âŒ Error: ${error.message}<br>
                        Please make sure the server is running at http://localhost:8000
                    </div>
                `;
            }
        }

        // Form submit handler
        document.getElementById('healthForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Store form data
            currentFormData = {
                user_id: 'demo-user',
                age: parseInt(document.getElementById('age').value),
                gender: document.getElementById('gender').value,
                height_cm: parseFloat(document.getElementById('height').value),
                weight_kg: parseFloat(document.getElementById('weight').value),
                target_weight_kg: parseFloat(document.getElementById('targetWeight').value),
                activity_level: document.getElementById('activity').value,
                health_goal: document.getElementById('goal').value
            };

            await fetchRecommendations();
        });

        // Add event listeners to all allergen checkboxes
        document.querySelectorAll('.allergen-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                if (currentFormData) {
                    fetchRecommendations();
                }
            });
        });

        // Chat functionality
        function addChatMessage(message, isUser = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isUser ? 'user' : 'assistant'}`;
            messageDiv.textContent = message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Handle chat send
        async function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatSendBtn = document.getElementById('chatSendBtn');
            const message = chatInput.value.trim();

            if (!message) return;

            // Add user message to chat
            addChatMessage(message, true);

            // Add typing indicator
            const chatMessages = document.getElementById('chatMessages');
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'chat-message assistant';
            typingIndicator.id = 'typing-indicator';
            typingIndicator.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
            chatMessages.appendChild(typingIndicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Disable input
            chatInput.disabled = true;
            chatSendBtn.disabled = true;
            chatSendBtn.textContent = 'ğŸ’¬ Thinking...';
            chatInput.value = '';

            try {
                // Call ChatGPT API
                const response = await fetch('http://localhost:8000/api/v1/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        conversation_history: conversationHistory
                    })
                });

                const result = await response.json();

                // Remove typing indicator
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    indicator.remove();
                }

                // Add assistant response to chat
                addChatMessage(result.response, false);

                // Update conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });
                conversationHistory.push({
                    role: 'assistant',
                    content: result.response
                });

                // Keep only last 10 messages (5 exchanges) for context
                if (conversationHistory.length > 10) {
                    conversationHistory = conversationHistory.slice(-10);
                }

                // Update body condition for meal recommendations
                bodyCondition = result.dietary_summary || message;

                // Store preferences from ChatGPT
                if (result.preferences) {
                    userPreferences = result.preferences;
                    console.log('Updated preferences:', userPreferences);
                }

                // Refresh recommendations if available
                if (currentFormData) {
                    await fetchRecommendations();
                }

            } catch (error) {
                console.error('Chat error:', error);

                // Remove typing indicator on error
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    indicator.remove();
                }

                addChatMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nSorry, there was a temporary error.', false);
            }

            // Re-enable input
            chatInput.disabled = false;
            chatSendBtn.disabled = false;
            chatSendBtn.textContent = 'ğŸ’¬ Send / ì „ì†¡';
        }

        document.getElementById('chatSendBtn').addEventListener('click', sendChatMessage);
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Function to re-render meals with current language
        function renderMeals() {
            if (!currentRecommendations) return;

            const mealsHTML = currentRecommendations.map(meal => `
                <div class="meal-card">
                    <h3>${currentLanguage === 'en' ? (meal.name_en || meal.name) : meal.name}</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                        ${meal.brand ? `<span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600;">ğŸ¢ ${meal.brand}</span>` : ''}
                        ${meal.category ? `<span style="background: #e3f2fd; color: #1976d2; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600;">ğŸ“¦ ${meal.category}</span>` : ''}
                    </div>
                    <span class="safe-badge safe">
                        ${currentLanguage === 'en' ? 'âœ… Safe for your allergies' : 'âœ… ì•Œë ˆë¥´ê¸° ì•ˆì „'}
                    </span>
                    ${meal.serving_size ? `<p style="color: #555; font-size: 14px; margin-top: 8px; margin-bottom: 15px;"><strong>${currentLanguage === 'en' ? 'Serving Size:' : '1íšŒ ì œê³µëŸ‰:'}</strong> ${meal.serving_size}</p>` : ''}
                    ${meal.origin ? `<p style="color: #555; font-size: 14px; margin-bottom: 15px;"><strong>${currentLanguage === 'en' ? 'Origin:' : 'ì›ì‚°ì§€:'}</strong> ${meal.origin}</p>` : ''}
                    <div class="meal-stats">
                        <div class="stat">
                            <div class="stat-value">${meal.calories}</div>
                            <div class="stat-label">${currentLanguage === 'en' ? 'Calories' : 'ì¹¼ë¡œë¦¬'}</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${meal.protein_g}g</div>
                            <div class="stat-label">${currentLanguage === 'en' ? 'Protein' : 'ë‹¨ë°±ì§ˆ'}</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${meal.carbs_g}g</div>
                            <div class="stat-label">${currentLanguage === 'en' ? 'Carbs' : 'íƒ„ìˆ˜í™”ë¬¼'}</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${meal.fat_g}g</div>
                            <div class="stat-label">${currentLanguage === 'en' ? 'Fat' : 'ì§€ë°©'}</div>
                        </div>
                        ${meal.sodium_mg ? `<div class="stat">
                            <div class="stat-value">${meal.sodium_mg}mg</div>
                            <div class="stat-label">${currentLanguage === 'en' ? 'Sodium' : 'ë‚˜íŠ¸ë¥¨'}</div>
                        </div>` : ''}
                    </div>
                    <p style="color: #666; line-height: 1.6;">
                        ${currentLanguage === 'en' ? meal.explanation_en : meal.explanation_ko}
                    </p>
                    <p style="margin-top: 10px; color: #667eea; font-weight: 600;">
                        ${currentLanguage === 'en' ? 'AI Score:' : 'AI ì ìˆ˜:'} ${meal.score}/100
                    </p>
                </div>
            `).join('');

            document.getElementById('mealsContainer').innerHTML = mealsHTML;
        }

        // Language toggle event listener
        const languageToggle = document.getElementById('languageToggle');
        if (languageToggle) {
            // Set initial state
            if (currentLanguage === 'en') {
                languageToggle.checked = true;
            }

            // Listen for toggle changes
            languageToggle.addEventListener('change', (e) => {
                currentLanguage = e.target.checked ? 'en' : 'ko';
                localStorage.setItem('fitmealor_language', currentLanguage);

                // Re-render meals if they exist
                renderMeals();
            });
        }
    </script>
</body>
</html>
